<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>To My Love</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            /* æ·±é‚ƒæ˜Ÿç©ºèƒŒæ™¯ */
            background: linear-gradient(to bottom, #090518, #181336, #2a2448);
            height: 100vh;
            font-family: "Microsoft YaHei", sans-serif;
            touch-action: none; /* ç¦æ­¢é»˜è®¤è§¦æ§è¡Œä¸ºï¼ˆå¦‚æ»šåŠ¨ï¼‰ï¼Œä¸“å¿ƒç©æ¸¸æˆ */
        }

        /* è®¡æ•°å™¨ */
        #counter-box {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 14px;
            z-index: 10;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€ï¼Œä¸æŒ¡æ‰‹ */
        }

        #counter-num {
            font-weight: bold;
            color: #ffd700;
            font-size: 18px;
            margin: 0 5px;
        }

        /* ç»“å±€é®ç½© */
        #ending-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease;
        }

        #ending-title {
            color: #ff69b4;
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-shadow: 0 0 15px #ff69b4;
            text-align: center;
            width: 90%;
        }

        #wishes-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            gap: 15px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto; /* å¦‚æœå±å¹•å°æ”¾ä¸ä¸‹ï¼Œå…è®¸å†…å®¹æ»šåŠ¨ */
        }

        .wish-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            color: #fff;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(20px);
            animation: cardAppear 0.6s forwards;
            text-align: center;
        }

        @keyframes cardAppear {
            to { opacity: 1; transform: translateY(0); }
        }

        /* ç‚¹å‡»ç‰¹æ•ˆ */
        .click-anim {
            position: absolute;
            pointer-events: none;
            animation: pop 0.6s ease-out forwards;
            font-size: 30px;
            z-index: 50;
        }
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="counter-box">
        è¯·æŒ‘é€‰ 10 ä¸ªæœ€é‡è¦çš„å¿ƒæ„¿ï¼š<span id="counter-num">0</span> / 10
    </div>

    <canvas id="canvas"></canvas>

    <div id="ending-overlay">
        <div id="ending-title">â¤ï¸ ç­”åº”ç»™ä½ çš„ 10 ä¸ªæœªæ¥ â¤ï¸</div>
        <div id="wishes-container"></div>
    </div>

<script>
        // --- 1. æµªæ¼«é…ç½®åŒº (è¯·åœ¨è¿™é‡Œä¿®æ”¹) ---
        const allMessages = [
            "YSLå£çº¢",
            "å¥–åŠ±æˆ‘åƒå°jioä¸€å£x10000",
            "ä¸€å°ä¿¡",
            "ç”œå“åŠµï¼ˆéšæ—¶ï¼‰",
            "ä½ çš„è´­ç‰©è½¦ï¼ˆç¬¬äºŒåä¸€ä¸ªï¼‰",
            "åœ£è¯å°ç¾Š",
            "YSLå£çº¢",
            "è¶³ç–—å·ï¼ˆç»™æˆ‘ï¼‰",
            "ä¸€åªå°çŒ«",
            "å°jioä¸“å±è¢œå­",
            "å•¤é…’æ¯",
            "ç»™ä½ é…ç½®X(å˜¿å˜¿å˜¿ï¼‰",
            "è€³é’‰",
            "æƒ…è¶£å†…è¡£x1",
            "ä»»æ„è¦æ±‚x1"
        ];
        
        const icons = ["ğŸ", "ğŸ€", "ğŸ§¸", "ğŸ’", "ğŸ’", "ğŸ¬", "ğŸ””", "ğŸ§¦", "ğŸ‘‘", "ğŸ’–", "ğŸµ", "ğŸŒŸ", "ğŸ¦„", "ğŸŒˆ", "ğŸ’Œ"];

        // --- 2. ç³»ç»Ÿåˆå§‹åŒ– ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let w, h;
        
        let gifts = [];
        let selectedGifts = [];
        const maxSelection = 10;
        let isEnding = false;

        function resize() {
            w = window.innerWidth;
            h = window.innerHeight;
            canvas.width = w;
            canvas.height = h;
            initGame(); 
        }
        window.addEventListener('resize', () => {
            setTimeout(resize, 200);
        });
        
        // --- 3. æ¸¸æˆæ ¸å¿ƒé€»è¾‘ ---

        // æ ¸å¿ƒä¿®æ”¹ï¼šæ ‘çš„å‚ç›´é—´è·æ”¹ä¸º 60ï¼Œæ›´ä¿®é•¿
        const VERTICAL_SPACING = 60;
        
        function initGame() {
            gifts = [];
            selectedGifts = [];
            document.getElementById('counter-num').textContent = "0";
            
            const treeBaseX = w / 2;
            const treeBaseY = h - 100;

            // æ™ºèƒ½åˆ†å¸ƒç®—æ³•ï¼šæŒ‡å®šæ¯ä¸€å±‚æ”¾å‡ ä¸ªç¤¼ç‰©ï¼Œä»¥åŠæ”¾åœ¨å“ªä¸€ä¾§ (æ–°ç­–ç•¥ï¼Œæœ€å¤§åŒ–åˆ†æ•£)
            const layersDistribution = [
                { level: 1, count: 1, position: 'center' }, 
                { level: 2, count: 1, position: 'left' },  
                { level: 3, count: 2, position: 'outer' },  // å·¦å³å¤–æ²¿
                { level: 4, count: 2, position: 'inner' },  // å·¦å³å†…ä¾§
                { level: 5, count: 3, position: 'scatter' }, // å·¦å³å’Œä¸­é—´
                { level: 6, count: 2, position: 'outer' },  
                { level: 7, count: 3, position: 'scatter' },
                { level: 8, count: 1, position: 'right' }
            ];

            let msgIndex = 0;

            layersDistribution.forEach(layer => {
                const levelY = treeBaseY - (layer.level * VERTICAL_SPACING) - 30;
                const levelWidth = 260 - (layer.level * 25); // ç¨å¾®åŠ å®½ä¸€ç‚¹
                
                for(let i = 0; i < layer.count; i++) {
                    if (msgIndex >= allMessages.length) break;
                    
                    let posX = treeBaseX;
                    const jitter = (Math.random() * 20) + 10; // éšæœºåç§»é‡
                    
                    // --- åˆ†æ•£ç­–ç•¥ ---
                    if (layer.position === 'center') {
                         posX = treeBaseX + (Math.random() * 10 - 5); // ä»…åœ¨ä¸­å¿ƒçº¿å¾®è°ƒ
                    } else if (layer.position === 'left') {
                         posX = treeBaseX - (levelWidth / 2) + jitter; // é å·¦ä¾§
                    } else if (layer.position === 'right') {
                         posX = treeBaseX + (levelWidth / 2) - jitter; // é å³ä¾§
                    } else if (layer.position === 'outer' && i < 2) { 
                        // å¤–æ²¿ï¼šä¸€ä¸ªåœ¨æå·¦ï¼Œä¸€ä¸ªåœ¨æå³
                        const sideMultiplier = (i % 2 === 0) ? -1 : 1; 
                        posX = treeBaseX + sideMultiplier * (levelWidth / 2 - 15) + (Math.random() * 10 - 5);
                    } else if (layer.position === 'inner' && i < 2) {
                        // å†…ä¾§ï¼šä¸€ä¸ªåœ¨å·¦å†…ï¼Œä¸€ä¸ªåœ¨å³å†…
                        const sideMultiplier = (i % 2 === 0) ? -1 : 1;
                        posX = treeBaseX + sideMultiplier * (levelWidth / 4) + (Math.random() * 10 - 5);
                    } else if (layer.position === 'scatter') {
                        // éšæœºæ•£å¼€ï¼ˆç”¨äº3ä¸ªç¤¼ç‰©çš„æƒ…å†µï¼‰
                        if (i === 0) posX = treeBaseX - (levelWidth / 2) + jitter; // å·¦
                        if (i === 1) posX = treeBaseX; // ä¸­
                        if (i === 2) posX = treeBaseX + (levelWidth / 2) - jitter; // å³
                    }
                    
                    gifts.push({
                        id: msgIndex,
                        x: posX,
                        y: levelY + (Math.random() * 20 - 10),
                        icon: icons[msgIndex % icons.length],
                        message: allMessages[msgIndex],
                        selected: false,
                        swingOffset: Math.random() * Math.PI * 2
                    });
                    msgIndex++;
                }
            });
        }

        // --- 4. ç»˜å›¾é€»è¾‘ ---
        
        function drawTree() {
            const x = w/2;
            const y = h - 100;
            const levels = 9; // 9å±‚æ ‘å¶
            
            ctx.save();
            ctx.fillStyle = "#4a2e18";
            ctx.fillRect(x - 25, y, 50, 60);
            
            for (let i = 0; i < levels; i++) {
                // ç¡®ä¿æ ‘å¶é—´è·å’Œç¤¼ç‰©é—´è·ä¸€è‡´
                let currentY = y - (i * VERTICAL_SPACING); 
                let width = 260 - (i * 24);
                
                if(w < 400) width *= 0.8;

                ctx.beginPath();
                ctx.moveTo(x, currentY - 65);
                ctx.quadraticCurveTo(x + width/2, currentY, x + width, currentY + 20);
                ctx.lineTo(x - width, currentY + 20);
                ctx.quadraticCurveTo(x - width/2, currentY, x, currentY - 65);
                
                let grd = ctx.createLinearGradient(x, currentY - 65, x, currentY + 20);
                grd.addColorStop(0, '#198754');
                grd.addColorStop(1, '#0f5132');
                ctx.fillStyle = grd;
                
                ctx.shadowBlur = 5;
                ctx.shadowColor = "rgba(0,0,0,0.3)";
                ctx.fill();
            }
            
            drawStar(x, y - (levels * VERTICAL_SPACING) - 40, 25);
            ctx.restore();
        }

        function drawStar(x, y, r) {
            ctx.save();
            ctx.beginPath();
            ctx.translate(x, y);
            ctx.moveTo(0, 0 - r);
            for (let i = 0; i < 5; i++) {
                ctx.rotate(Math.PI / 5);
                ctx.lineTo(0, 0 - (r * 0.5));
                ctx.rotate(Math.PI / 5);
                ctx.lineTo(0, 0 - r);
            }
            ctx.fillStyle = "#ffd700";
            ctx.shadowBlur = 20;
            ctx.shadowColor = "gold";
            ctx.fill();
            ctx.restore();
        }

        function drawGifts() {
            ctx.font = "32px Arial"; 
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            gifts.forEach(g => {
                let scale = g.selected ? 1.3 : 1;
                let swing = Math.sin(Date.now() / 600 + g.swingOffset) * 6;
                
                ctx.save();
                ctx.translate(g.x, g.y + swing);
                ctx.scale(scale, scale);
                
                if(g.selected) {
                    ctx.shadowColor = "#ff69b4"; 
                    ctx.shadowBlur = 25;
                } else {
                    ctx.shadowBlur = 0;
                }

                ctx.fillText(g.icon, 0, 0);
                
                if(g.selected) {
                    ctx.font = "18px Arial";
                    ctx.fillText("â¤ï¸", 18, -18);
                }
                ctx.restore();
            });
        }

        // --- 5. äº¤äº’é€»è¾‘ (æ”¯æŒè§¦æ‘¸) ---
        
        const hitRadius = 45; // ä¿æŒå¤§ç‚¹å‡»èŒƒå›´

        function handleInput(clientX, clientY) {
            if(isEnding) return;

            // å¯»æ‰¾è¢«ç‚¹å‡»çš„ç¤¼ç‰©
            let clickedGift = null;
            
            for(let i = gifts.length - 1; i >= 0; i--) {
                const g = gifts[i];
                const dx = clientX - g.x;
                const dy = clientY - g.y;
                if(Math.sqrt(dx*dx + dy*dy) < hitRadius) {
                    clickedGift = g;
                    break; 
                }
            }

            if(clickedGift) {
                toggleGift(clickedGift);
            }
        }

        canvas.addEventListener('mousedown', (e) => handleInput(e.clientX, e.clientY));
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            const touch = e.touches[0];
            handleInput(touch.clientX, touch.clientY);
        }, {passive: false});

        function toggleGift(gift) {
            if(gift.selected) {
                gift.selected = false;
                selectedGifts = selectedGifts.filter(item => item.id !== gift.id);
            } else {
                if(selectedGifts.length < maxSelection) {
                    gift.selected = true;
                    selectedGifts.push(gift);
                    createClickEffect(gift.x, gift.y);
                    if(navigator.vibrate) navigator.vibrate(50);
                } else {
                    const counter = document.getElementById('counter-box');
                    counter.style.background = "rgba(255,0,0,0.5)";
                    setTimeout(() => counter.style.background = "rgba(255,255,255,0.2)", 200);
                }
            }
            updateUI();
        }

        function createClickEffect(x, y) {
            const el = document.createElement('div');
            el.textContent = "âœ¨";
            el.className = "click-anim";
            el.style.left = x + "px";
            el.style.top = y + "px";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }

        function updateUI() {
            const count = selectedGifts.length;
            document.getElementById('counter-num').textContent = count;

            if(count === maxSelection) {
                setTimeout(showEnding, 800);
            }
        }

        function showEnding() {
            isEnding = true;
            const overlay = document.getElementById('ending-overlay');
            const container = document.getElementById('wishes-container');
            
            container.innerHTML = "";
            selectedGifts.forEach((gift, index) => {
                const card = document.createElement('div');
                card.className = 'wish-card';
                card.style.animationDelay = (index * 0.1) + "s";
                card.innerHTML = `<span style="font-size:1.5rem">${gift.icon}</span><br>${gift.message}`;
                container.appendChild(card);
            });

            overlay.style.display = 'flex';
            requestAnimationFrame(() => {
                overlay.style.opacity = 1;
            });
        }

        // é›ªèŠ±
        const snows = Array.from({length: 50}, () => ({
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            r: Math.random() * 2 + 1,
            speed: Math.random() + 0.5
        }));

        // å¯åŠ¨
        resize();

        function animate() {
            ctx.clearRect(0, 0, w, h);
            
            // ç”»æœˆäº®
            ctx.fillStyle = "#fffce6";
            ctx.shadowBlur = 40;
            ctx.shadowColor = "#fffce6";
            ctx.beginPath();
            ctx.arc(w * 0.85, h * 0.1, 30, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;

            drawTree();
            drawGifts();
            
            // ç”»é›ªèŠ±
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            ctx.beginPath();
            snows.forEach(s => {
                ctx.moveTo(s.x, s.y);
                ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
                s.y += s.speed;
                if(s.y > h) s.y = -10;
            });
            ctx.fill();

            requestAnimationFrame(animate);
        }
        animate();

    </script>
</body>
</html>